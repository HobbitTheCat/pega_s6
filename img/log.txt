=================================================================
==107873==ERROR: AddressSanitizer: heap-use-after-free on address 0x7cfafabeb650 at pc 0x55629fbc72e0 bp 0x7beaf87fe7b0 sp 0x7beaf87fe7a0
READ of size 4 at 0x7cfafabeb650 thread T1
    #0 0x55629fbc72df in unregister_session src/Server/server_session.c:86
    #1 0x55629fbc83a1 in handle_bus_message src/Server/server_session.c:129
    #2 0x55629fbcbe1d in server_main src/Server/server.c:194
    #3 0x7feafca5e11a in asan_thread_start /usr/src/debug/gcc/gcc/libsanitizer/asan/asan_interceptors.cpp:239
    #4 0x7feafbe9698a  (/usr/lib/libc.so.6+0x9698a) (BuildId: 2f722da304c0a508c891285e6840199c35019c8d)
    #5 0x7feafbf1a9cb  (/usr/lib/libc.so.6+0x11a9cb) (BuildId: 2f722da304c0a508c891285e6840199c35019c8d)

0x7cfafabeb650 is located 208 bytes inside of 232-byte region [0x7cfafabeb580,0x7cfafabeb668)
freed by thread T19 here:
    #0 0x7feafcb1f79d in free /usr/src/debug/gcc/gcc/libsanitizer/asan/asan_malloc_linux.cpp:51
    #1 0x55629fba9d87 in destroy_session_bus src/SupportStructure/session_bus.c:53
    #2 0x55629fbb7db1 in cleanup_session src/Session/session.c:45
    #3 0x55629fbb93b8 in session_main src/Session/session.c:123
    #4 0x7feafca5e11a in asan_thread_start /usr/src/debug/gcc/gcc/libsanitizer/asan/asan_interceptors.cpp:239
    #5 0x7feafbe9698a  (/usr/lib/libc.so.6+0x9698a) (BuildId: 2f722da304c0a508c891285e6840199c35019c8d)

previously allocated by thread T1 here:
    #0 0x7feafcb20cb5 in malloc /usr/src/debug/gcc/gcc/libsanitizer/asan/asan_malloc_linux.cpp:67
    #1 0x55629fba93a7 in create_session_bus src/SupportStructure/session_bus.c:10
    #2 0x55629fbb7714 in init_session src/Session/session.c:29
    #3 0x55629fbc5caa in create_new_session src/Server/server_session.c:56
    #4 0x55629fbc4fde in handle_session_create_packet src/Server/server_packet.c:151
    #5 0x55629fbc0764 in handle_packet_main src/Server/packet_handler.c:30
    #6 0x55629fbcce12 in handle_read src/Server/server.c:254
    #7 0x55629fbcbd67 in server_main src/Server/server.c:191
    #8 0x7feafca5e11a in asan_thread_start /usr/src/debug/gcc/gcc/libsanitizer/asan/asan_interceptors.cpp:239
    #9 0x7feafbe9698a  (/usr/lib/libc.so.6+0x9698a) (BuildId: 2f722da304c0a508c891285e6840199c35019c8d)

Thread T1 created by T0 here:
    #0 0x7feafcb1732c in pthread_create /usr/src/debug/gcc/gcc/libsanitizer/asan/asan_interceptors.cpp:250
    #1 0x55629fb9d804 in main test/test_server_connection.c:25
    #2 0x7feafbe27634  (/usr/lib/libc.so.6+0x27634) (BuildId: 2f722da304c0a508c891285e6840199c35019c8d)
    #3 0x7feafbe276e8 in __libc_start_main (/usr/lib/libc.so.6+0x276e8) (BuildId: 2f722da304c0a508c891285e6840199c35019c8d)
    #4 0x55629fb9d594 in _start (/home/egor/Projects/University/L3/SystemResaux/Project3/build/test_server_connection+0x51594) (BuildId: f40afd530fcc25ccbe1fb8665f85ca92d0dda301)

Thread T19 created by T1 here:
    #0 0x7feafcb1732c in pthread_create /usr/src/debug/gcc/gcc/libsanitizer/asan/asan_interceptors.cpp:250
    #1 0x55629fbc6c52 in create_new_session src/Server/server_session.c:72
    #2 0x55629fbc4fde in handle_session_create_packet src/Server/server_packet.c:151
    #3 0x55629fbc0764 in handle_packet_main src/Server/packet_handler.c:30
    #4 0x55629fbcce12 in handle_read src/Server/server.c:254
    #5 0x55629fbcbd67 in server_main src/Server/server.c:191
    #6 0x7feafca5e11a in asan_thread_start /usr/src/debug/gcc/gcc/libsanitizer/asan/asan_interceptors.cpp:239
    #7 0x7feafbe9698a  (/usr/lib/libc.so.6+0x9698a) (BuildId: 2f722da304c0a508c891285e6840199c35019c8d)

SUMMARY: AddressSanitizer: heap-use-after-free src/Server/server_session.c:86 in unregister_session
Shadow bytes around the buggy address:
  0x7cfafabeb380: 00 00 00 00 00 00 00 00 00 00 00 00 00 fa fa fa
  0x7cfafabeb400: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00
  0x7cfafabeb480: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x7cfafabeb500: 00 00 00 00 00 fa fa fa fa fa fa fa fa fa fa fa
  0x7cfafabeb580: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
=>0x7cfafabeb600: fd fd fd fd fd fd fd fd fd fd[fd]fd fd fa fa fa
  0x7cfafabeb680: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd
  0x7cfafabeb700: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x7cfafabeb780: fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa
  0x7cfafabeb800: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x7cfafabeb880: fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
==107873==ABORTING
